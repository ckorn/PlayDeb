#!/usr/bin/make -f
# -*- makefile -*-
export DH_OPTIONS

%:
	dh $@ --sourcedirectory=src

override_dh_auto_build:
	convert -resize 48x48 'src/redeclipse.ico[2]' debian/redeclipse.png
	convert 'src/redeclipse.ico[1]' debian/redeclipse.xpm
	dh_auto_build -- all

override_dh_install:
	dh_install --exclude="license.txt"

override_dh_strip:
	dh_strip -predeclipse --dbg-package=redeclipse-dbg
	dh_strip

URL=https://redeclipse.svn.sourceforge.net/svnroot/redeclipse
REV=$(shell dpkg-parsechangelog | sed -rne 's,^Version: .*[+~]svn([0-9]+).*,\1,p')
VER=$(shell dpkg-parsechangelog | sed -rne 's,^Version: ([^-]+).*,\1,p')
DIR=redeclipse-$(VER).orig
TARBALL=redeclipse_$(VER).orig.tar.gz
get-orig-source:
	rm -rf $(DIR)
	svn -q export -r $(REV) $(URL) $(DIR)
	cd $(DIR)
	rm -rf $(DIR)/src/include/
	rm -rf $(DIR)/src/xcode/
	rm -rf $(DIR)/src/lib/
	rm -rf $(DIR)/src/site/
	rm -rf $(DIR)/bin/
	rm -f $(DIR)/data/fonts/akashi.ttf
	GZIP=--best tar -cz --owner root --group root --mode a+rX \
		-f $(TARBALL) $(DIR)
	rm -rf $(DIR)
