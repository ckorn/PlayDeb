#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh $@ --sourcedirectory=src

override_dh_auto_build:
	convert -resize 48x48 'src/redeclipse.ico[2]' debian/redeclipse.png
	convert 'src/redeclipse.ico[1]' debian/redeclipse.xpm
	dh_auto_build

override_dh_strip:
	dh_strip -predeclipse --dbg-package=redeclipse-dbg
	dh_strip

override_dh_clean:
	dh_clean debian/redeclipse.png debian/redeclipse.xpm bin/reclient_native bin/reserver_native

URL="https://redeclipse.svn.sourceforge.net/svnroot/redeclipse"
REV="$(shell dpkg-parsechangelog | sed -rne 's,^Version: .*[+~]svn([0-9]+).*,\1,p')"
VER="$(shell dpkg-parsechangelog | sed -rne 's,^Version: ([^-]+).*,\1,p')"
DIR="redeclipse-$(VER).orig"
TARBALL="$(DIR).tar.gz"
get-orig-source:
	rm -rf $(DIR)
	svn -q export -r $(REV) $(URL) $(DIR)
	( \
		cd $(DIR)
		rm -rf src/include/
		rm -rf src/xcode/
		rm -rf src/lib/
		rm -rf src/site/
		rm -rf bin/
		rm -f data/fonts/akashi.ttf
	GZIP=--best tar -cz --owner root --group root --mode a+rX \
		-f $(TARBALL) $(DIR)
	rm -rf $(DIR)
